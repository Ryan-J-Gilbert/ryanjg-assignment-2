<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>KMeans Visualization</title>
</head>

<body>
    <form id="kmeans_form" method="POST">
        <div>
            <label for="k">Number of Clusters (k):</label>
            <input type="number" id="k" name="k" value="{{ k | default(3) }}">
        </div>
        <div>
            <label for="init_method">Initialization Method:</label>
            <select id="init_method" name="init_method">
                <option value="random" {% if method == 'random' %}selected{% endif %}>Random</option>
                <option value="farthest" {% if method == 'farthest' %}selected{% endif %}>Farthest</option>
                <option value="kmeans++" {% if method == 'kmeans++' %}selected{% endif %}>KMeans++</option>
            </select>
        </div>

        <input type="hidden" id="step_count" name="step_count" value="{{ step_count | default(-1) }}">

        <!-- Three buttons for different actions -->
        <button type="submit" formaction="/generate_dataset">Generate Dataset</button>
        <button type="submit" formaction="/run_kmeans">Run KMeans</button>
        <button type="submit" formaction="/step">Step</button>
        <button type="submit" formaction="/reset_kmeans">Reset</button>
    </form>

    <div id="plot">{{ plot_html | safe }}</div> <!-- Placeholder for the Plotly graph -->

    <!-- if warning is sent in as True, we should send an alert kmeans has converged -->
    {% if warning | default(false) %}
    <script>
        alert("KMeans has converged!");
    </script>
    {% endif %}

    <script>
        function captureManualPoints(event) {
            const coords = event.points[0];  // Get the clicked point coordinates
            manualCenters.push([coords.x, coords.y]); // Store in manualCenters array
            console.log("Manual centers: ", manualCenters);
            
            // You can update the plot here to reflect the clicked points
        }
        // Add Plotly click event for manual point selection
        document.getElementById('plot').on('plotly_click', captureManualPoints);
    </script>

</body>

</html>
